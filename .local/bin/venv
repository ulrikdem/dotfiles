#!/bin/bash

[[ $1 = -c ]] && shift && create=1 || create=0
arg=${1:-.}
shift

[[ -f $arg/pyvenv.cfg || ! -d $arg ]] && venv=$arg || venv=$arg/.venv
venv=$(realpath -m -- "$venv")

if ((create)); then
    python -m venv -- "$venv" || exit
elif [[ ! -f $venv/pyvenv.cfg ]]; then
    echo "error: neither $arg nor $arg/.venv is a virtual environment" >&2
    exit 1
fi

[[ $1 = jupyter-lab ]] && set -- -xur ~/.jupyter/lab/user-settings "$@"
exec sb -w ":$arg" -w ":$venv" -e VIRTUAL_ENV="$venv" -e PATH="$venv/bin:$PATH" "$@"
